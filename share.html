<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Witness | Sharing Alert</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { 
            background: #000; 
            color: #fff; 
            font-family: -apple-system, sans-serif; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            height: 100vh; 
            margin: 0;
        }
        .status-dot {
            width: 12px;
            height: 12px;
            background: #FF3B30;
            border-radius: 50%;
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.5); opacity: 0.5; }
            100% { transform: scale(1); opacity: 1; }
        }
    </style>
</head>
<body>

    <div class="text-center flex flex-col items-center gap-4">
        <div class="status-dot"></div>
        <p class="text-[10px] font-black uppercase tracking-[0.2em] opacity-50">Opening Share Menu...</p>
    </div>

    <script>
        // 1. Extract the text from the URL parameters
        const params = new URLSearchParams(window.location.search);
        const textToShare = params.get('text');

        async function triggerShare() {
            if (!textToShare) {
                console.error("No text provided to share.");
                window.close();
                return;
            }

            // 2. Check for native Share API (Mobile Safari/Chrome)
            if (navigator.share) {
                try {
                    await navigator.share({
                        title: 'WITNESS ALERT',
                        text: textToShare,
                        // url: 'https://wn.fynn.qzz.io/map.html' // Optional extra URL field
                    });
                    console.log("Share successful");
                    window.close();
                } catch (err) {
                    console.log("Share cancelled or failed:", err);
                    // Close anyway to return user to home screen
                    window.close();
                }
            } else {
                // 3. Fallback for Desktop/Legacy: Copy to clipboard
                try {
                    await navigator.clipboard.writeText(textToShare);
                    alert("Native share not supported. Alert text copied to clipboard instead.");
                } catch (err) {
                    console.error("Clipboard fallback failed");
                }
                window.close();
            }
        }

        // Run immediately on load
        window.onload = () => {
            // Small delay to ensure the browser is ready to show the UI
            setTimeout(triggerShare, 100);
        };

        // If the window is still open after 30 seconds (user got stuck), close it.
        setTimeout(() => window.close(), 30000);
    </script>
</body>
</html>